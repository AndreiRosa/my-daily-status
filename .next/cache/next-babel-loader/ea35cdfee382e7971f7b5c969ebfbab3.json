{"ast":null,"code":"import admin from \"firebase-admin\";\nimport { db } from \"../../lib/db\";\nimport auth0 from \"../../lib/auth0\";\nexport default async function saveStatus(req, res) {\n  const {\n    status,\n    coords\n  } = req.body;\n  const session = await auth0.getSession(req);\n  const currentDate = new Date().toISOString().substr(0, 10);\n\n  try {\n    if (session) {\n      await db.collection(\"markers\").doc(currentDate).collection(\"checks\").doc(session.user.sub).set({\n        status,\n        user: session.user.sub,\n        coordinates: new admin.firestore.GeoPoint(coords.latitude, coords.longitude)\n      });\n      res.send({\n        ok: true\n      });\n    }\n  } catch (error) {\n    console.error(error);\n    res.status(error.status || 400).end(error.message);\n  }\n}","map":{"version":3,"sources":["C:/Users/andre/Desktop/mydailystatus/pages/api/save-status.js"],"names":["admin","db","auth0","saveStatus","req","res","status","coords","body","session","getSession","currentDate","Date","toISOString","substr","collection","doc","user","sub","set","coordinates","firestore","GeoPoint","latitude","longitude","send","ok","error","console","end","message"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,gBAAlB;AACA,SAASC,EAAT,QAAmB,cAAnB;AACA,OAAOC,KAAP,MAAkB,iBAAlB;AAEA,eAAe,eAAeC,UAAf,CAA0BC,GAA1B,EAA+BC,GAA/B,EAAoC;AACjD,QAAM;AAAEC,IAAAA,MAAF;AAAUC,IAAAA;AAAV,MAAqBH,GAAG,CAACI,IAA/B;AACA,QAAMC,OAAO,GAAG,MAAMP,KAAK,CAACQ,UAAN,CAAiBN,GAAjB,CAAtB;AACA,QAAMO,WAAW,GAAG,IAAIC,IAAJ,GAAWC,WAAX,GAAyBC,MAAzB,CAAgC,CAAhC,EAAmC,EAAnC,CAApB;;AAEA,MAAI;AACF,QAAIL,OAAJ,EAAa;AACX,YAAMR,EAAE,CACLc,UADG,CACQ,SADR,EAEHC,GAFG,CAECL,WAFD,EAGHI,UAHG,CAGQ,QAHR,EAIHC,GAJG,CAICP,OAAO,CAACQ,IAAR,CAAaC,GAJd,EAKHC,GALG,CAKC;AACHb,QAAAA,MADG;AAEHW,QAAAA,IAAI,EAAER,OAAO,CAACQ,IAAR,CAAaC,GAFhB;AAGHE,QAAAA,WAAW,EAAE,IAAIpB,KAAK,CAACqB,SAAN,CAAgBC,QAApB,CACXf,MAAM,CAACgB,QADI,EAEXhB,MAAM,CAACiB,SAFI;AAHV,OALD,CAAN;AAaAnB,MAAAA,GAAG,CAACoB,IAAJ,CAAS;AAAEC,QAAAA,EAAE,EAAE;AAAN,OAAT;AACD;AACF,GAjBD,CAiBE,OAAOC,KAAP,EAAc;AACdC,IAAAA,OAAO,CAACD,KAAR,CAAcA,KAAd;AACAtB,IAAAA,GAAG,CAACC,MAAJ,CAAWqB,KAAK,CAACrB,MAAN,IAAgB,GAA3B,EAAgCuB,GAAhC,CAAoCF,KAAK,CAACG,OAA1C;AACD;AACF","sourcesContent":["import admin from \"firebase-admin\";\r\nimport { db } from \"../../lib/db\";\r\nimport auth0 from \"../../lib/auth0\";\r\n\r\nexport default async function saveStatus(req, res) {\r\n  const { status, coords } = req.body;\r\n  const session = await auth0.getSession(req);\r\n  const currentDate = new Date().toISOString().substr(0, 10);\r\n\r\n  try {\r\n    if (session) {\r\n      await db\r\n        .collection(\"markers\")\r\n        .doc(currentDate)\r\n        .collection(\"checks\")\r\n        .doc(session.user.sub)\r\n        .set({\r\n          status,\r\n          user: session.user.sub,\r\n          coordinates: new admin.firestore.GeoPoint(\r\n            coords.latitude,\r\n            coords.longitude\r\n          ),\r\n        });\r\n      res.send({ ok: true });\r\n    }\r\n  } catch (error) {\r\n    console.error(error);\r\n    res.status(error.status || 400).end(error.message);\r\n  }\r\n}"]},"metadata":{},"sourceType":"module"}